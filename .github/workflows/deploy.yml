name: deploy QNQMinds

on:
  push:
    branches:
      - main

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Install Dependencies
        run: npm install

      - name: Build Angular Universal App
        run: npm run build -- --configuration production

      - name:  Deploy to Shared Hosting via FTP
        uses: SamKirkland/FTP-Deploy-Action@v4.3.4
        with:
          server: ${{ secrets.FTP_HOST }}
          username: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          local-dir: ./dist/vishal-website/browser
          server-dir: ${{ secrets.FTP_REMOTE_DIR }}

  notify-success:
    needs: build-and-deploy
    if: success()
    runs-on: ubuntu-latest
    steps:
      - name: üìß Email on Success
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: mail.qnqminds.com
          server_port: 465
          username: ${{ secrets.EMAIL_USERNAME }}
          password: ${{ secrets.EMAIL_PASSWORD }}
          subject: "‚úÖ SUCCESS: Angular App Deployed"
          to: mailtovishal01@gmail.com.com
          from: ${{ secrets.EMAIL_USERNAME }}
          body: |
            ‚úÖ Deployment succeeded!
            Your Angular 18 app has been successfully deployed via GitHub Actions.

  notify-failure:
    needs: build-and-deploy
    if: failure()
    runs-on: ubuntu-latest
    steps:
      - name: Email on Failure
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: mail.qnqminds.com
          server_port: 465
          username: ${{ secrets.EMAIL_USERNAME }}
          password: ${{ secrets.EMAIL_PASSWORD }}
          subject: "FAILURE: Angular Deployment Failed"
          to: mailtovishal01@gmail.com
          from: ${{ secrets.EMAIL_USERNAME }}
          body: |
            ‚ùå Deployment failed!
            Please check the GitHub Actions logs for more info.

  notify-cancelled:
    needs: build-and-deploy
    if: cancelled()
    runs-on: ubuntu-latest
    steps:
      - name: ‚ö†Ô∏è Email on Cancelled
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: mail.qnqminds.com
          server_port: 465
          username: ${{ secrets.EMAIL_USERNAME }}
          password: ${{ secrets.EMAIL_PASSWORD }}
          subject: "‚ö†Ô∏è CANCELLED: Angular Deployment Cancelled"
          to: mailtovishal01@gmail.com
          from: ${{ secrets.EMAIL_USERNAME }}
          body: |
            ‚ö†Ô∏è Deployment was cancelled.
            Please verify if it was intentional.

